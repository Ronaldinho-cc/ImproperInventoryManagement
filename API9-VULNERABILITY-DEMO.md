# Demo: OWASP API9:2023 - Improper Inventory Management

## ¿Qué es la vulnerabilidad API9:2023?

**Improper Inventory Management** ocurre cuando:
- No tienes un inventario completo de tus APIs
- Versiones obsoletas siguen activas sin advertencias
- Documentación desactualizada o inexistente
- Endpoints "olvidados" en producción
- Falta de versionado claro

## Demostración de la Vulnerabilidad

### Problemas en la versión vulnerable:

#### 1. **UserControllerV1** (`/api/users`)
- ❌ Sin versionado explícito en la URL
- ❌ Expone passwords en las respuestas
- ❌ Sin documentación OpenAPI/Swagger
- ❌ Sin advertencias de deprecación

#### 2. **LegacyApiController** (`/legacy`)
- ❌ API obsoleta sin documentar
- ❌ Endpoints de prueba en producción
- ❌ Endpoints internos expuestos públicamente
- ❌ Sin fecha de sunset definida

### Cómo probar la vulnerabilidad:

1. **Ejecutar la aplicación:**
   ```bash
   mvn spring-boot:run
   ```

2. **Probar endpoints vulnerables:**
   ```bash
   # Expone passwords
   curl http://localhost:8089/api/users
   
   # Endpoint obsoleto sin documentar
   curl http://localhost:8089/legacy/old-endpoint
   
   # Endpoint interno expuesto
   curl http://localhost:8089/legacy/internal/config
   ```

## Solución Implementada

### 1. **Versionado Explícito**
- ✅ URLs con versión: `/api/v2/users`
- ✅ Información de versiones disponibles

### 2. **DTOs Seguros**
- ✅ `UserResponseDto`: No expone passwords
- ✅ `UserCreateDto`: Para entrada de datos
- ✅ Separación clara entre entrada y salida

### 3. **Documentación Completa**
- ✅ OpenAPI/Swagger configurado
- ✅ Documentación de cada endpoint
- ✅ Ejemplos y descripciones

### 4. **Inventario de APIs**
- ✅ Endpoint `/api/v2/inventory` con información de versiones
- ✅ Lista de endpoints deprecados
- ✅ Fechas de sunset definidas

### Cómo probar la solución:

1. **Acceder a la documentación:**
   ```
   http://localhost:8089/swagger-ui.html
   ```

2. **Probar endpoints seguros:**
   ```bash
   # No expone passwords
   curl http://localhost:8089/api/v2/users
   
   # Información del inventario de APIs
   curl http://localhost:8089/api/v2/inventory
   
   # Lista de endpoints deprecados
   curl http://localhost:8089/api/v2/inventory/deprecated
   ```

## Mejores Prácticas Implementadas

### 1. **Gestión de Versiones**
- Versionado semántico
- URLs con versión explícita
- Información de compatibilidad

### 2. **Documentación**
- OpenAPI 3.0 completo
- Ejemplos en cada endpoint
- Descripciones detalladas

### 3. **Seguridad**
- DTOs que no exponen datos sensibles
- Validación de entrada
- Respuestas estructuradas

### 4. **Monitoreo**
- Spring Boot Actuator
- Métricas de endpoints
- Health checks

## Comandos para Probar

```bash
# Compilar y ejecutar
mvn clean spring-boot:run

# Probar endpoint vulnerable (v1)
curl -X GET http://localhost:8089/api/users

# Probar endpoint seguro (v2)
curl -X GET http://localhost:8089/api/v2/users

# Ver inventario de APIs
curl -X GET http://localhost:8089/api/v2/inventory

# Ver documentación
# Abrir: http://localhost:8089/swagger-ui.html
```

## Conclusión

Esta demo muestra cómo la falta de inventario adecuado puede exponer:
- Información sensible
- Endpoints obsoletos
- APIs sin documentar
- Versiones inseguras

La solución implementa un inventario completo con versionado, documentación y gestión adecuada del ciclo de vida de las APIs.